"use strict";const e=require("../../common/vendor.js"),t={name:"my-login",data:()=>({}),computed:{...e.mapState("m_user",["redirectInfo"])},methods:{...e.mapMutations("m_user",["updateUserInfo","updateToken","updataRedirectInfo"]),getUserProfile(){var t=this;e.index.getUserProfile({desc:"test",lang:"zh_CN",success(e){t.updateUserInfo(e.userInfo),t.getToken(e)},fail(t){if("getUserProfile:fail auth deny"===t.errMsg)return e.index.$showMsg("您取消了登录授权");e.index.$showMsg("授权失败")}})},getToken(t){e.index.login({success:async o=>{if(console.log("login"),console.log("this:",this),"login:ok"!==o.errMsg)return e.index.$showMsg("登录失败");const s={code:o.code,encryptedData:t.encryptedData,iv:t.iv,rawData:t.rawData,signature:t.signature};await e.index.$http.post("/api/public/v1/users/wxlogin",s);this.updateToken("f283fdis"),this.navigateBack()}})},navigateBack(){this.redirectInfo&&"switchTab"===this.redirectInfo.openType&&(console.log("if"),e.index.switchTab({url:this.redirectInfo.from,complete:()=>{console.log("this:",this),console.log("redi"),this.updataRedirectInfo(null)}}))}}};if(!Array){e.resolveComponent("uni-icons")()}Math;const o=e._export_sfc(t,[["render",function(t,o,s,i,n,r){return{a:e.p({type:"contact-filled",size:"100",color:"#AFAFAF"}),b:e.o(((...e)=>r.getUserProfile&&r.getUserProfile(...e)))}}]]);wx.createComponent(o);
